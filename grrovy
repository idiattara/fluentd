import groovy.json.JsonSlurper

flowFile = session.get()
if (flowFile) {
    try {
        // Lire la valeur de l'attribut "votre_attribut" (remplacez par le nom de votre attribut)
        jsonAttribute = flowFile.getAttribute('votre_attribut')

        // Utiliser JsonSlurper pour analyser l'attribut JSON
        def jsonSlurper = new JsonSlurper()
        def jsonObject = jsonSlurper.parseText(jsonAttribute)

        // Vérifier si l'objet JSON contient une entrée "nom" égale à "diattar"
        if (jsonObject.nom == "diattar") {
            // Extraire la valeur de "composit" si "nom" est égal à "diattar"
            def compositValue = jsonObject.composit.toString()
            
            // Mettre la valeur de "composit" dans un nouvel attribut
            flowFile = session.putAttribute(flowFile, 'composit_diattar', compositValue)
            
            // Transférer le flow file avec le nouvel attribut
            session.transfer(flowFile, REL_SUCCESS)
        } else {
            // Si "nom" n'est pas égal à "diattar", transférer le flow file sans modification
            session.transfer(flowFile, REL_SUCCESS)
        }
    } catch (Exception e) {
        // Gérer l'exception ici, par exemple, la journaliser
        getLogger().error("Erreur lors du traitement du flow file : ${e.toString()}")
        session.transfer(flowFile, REL_FAILURE) // Facultatif : Vous pouvez également le transférer vers une relation d'échec
    }
}
