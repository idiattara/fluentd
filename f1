import groovy.json.JsonSlurper

def flowFile = session.get()
if (!flowFile) {
    return
}

try {
    // Lecture du contenu du FlowFile
    def flowFileContent = session.read(flowFile).getText('UTF-8')

    // Utilisation de JsonSlurper pour traiter le contenu MSD (assurez-vous que votre format est compatible)
    def slurper = new JsonSlurper()
    def msdData = slurper.parseText(flowFileContent)

    // Extraction des attributs
    def network = msdData.network
    def station = msdData.station
    def location = msdData.location

    // Log des attributs extraits
    log.info("Network: $network, Station: $station, Location: $location")

    // Ajout des attributs en tant qu'attributs de flux
    flowFile = session.putAttribute(flowFile, 'network', network)
    flowFile = session.putAttribute(flowFile, 'station', station)
    flowFile = session.putAttribute(flowFile, 'location', location)

    // Transfert du FlowFile au prochain processeur
    session.transfer(flowFile, REL_SUCCESS)

} catch (Exception e) {
    // En cas d'exception, enregistrer l'erreur et transférer le FlowFile vers la relation d'échec
    log.error("Erreur lors du traitement du FlowFile: ${e.message}")
    session.transfer(flowFile, REL_FAILURE)
}
